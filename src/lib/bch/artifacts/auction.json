{
  "contractName": "Auction",
  "constructorInputs": [
    {
      "name": "sellerPkh",
      "type": "bytes20"
    },
    {
      "name": "minBid",
      "type": "int"
    },
    {
      "name": "endTime",
      "type": "int"
    },
    {
      "name": "creatorPkh",
      "type": "bytes20"
    },
    {
      "name": "royaltyBasisPoints",
      "type": "int"
    },
    {
      "name": "minBidIncrement",
      "type": "int"
    }
  ],
  "abi": [
    {
      "name": "bid",
      "inputs": [
        {
          "name": "currentBidAmount",
          "type": "int"
        }
      ]
    },
    {
      "name": "claim",
      "inputs": [
        {
          "name": "finalBidAmount",
          "type": "int"
        },
        {
          "name": "winnerPkh",
          "type": "bytes20"
        }
      ]
    },
    {
      "name": "reclaim",
      "inputs": [
        {
          "name": "pk",
          "type": "pubkey"
        },
        {
          "name": "s",
          "type": "sig"
        }
      ]
    }
  ],
  "bytecode": "OP_6 OP_PICK OP_0 OP_NUMEQUAL OP_IF OP_7 OP_PICK OP_INPUTINDEX OP_UTXOVALUE OP_NUMEQUALVERIFY OP_0 OP_OUTPUTVALUE OP_8 OP_PICK OP_0 OP_GREATERTHAN OP_IF OP_DUP OP_9 OP_PICK OP_8 OP_PICK OP_ADD OP_GREATERTHANOREQUAL OP_VERIFY OP_ELSE OP_DUP OP_3 OP_PICK OP_GREATERTHANOREQUAL OP_VERIFY OP_ENDIF OP_0 OP_OUTPUTBYTECODE OP_INPUTINDEX OP_UTXOBYTECODE OP_EQUALVERIFY OP_0 OP_OUTPUTTOKENCATEGORY OP_INPUTINDEX OP_UTXOTOKENCATEGORY OP_EQUALVERIFY OP_0 OP_OUTPUTTOKENAMOUNT OP_INPUTINDEX OP_UTXOTOKENAMOUNT OP_NUMEQUALVERIFY OP_0 OP_OUTPUTTOKENCOMMITMENT OP_INPUTINDEX OP_UTXOTOKENCOMMITMENT OP_EQUALVERIFY OP_2DROP OP_2DROP OP_2DROP OP_2DROP OP_DROP OP_1 OP_ELSE OP_6 OP_PICK OP_1 OP_NUMEQUAL OP_IF OP_7 OP_PICK OP_INPUTINDEX OP_UTXOVALUE OP_NUMEQUALVERIFY OP_ROT OP_CHECKLOCKTIMEVERIFY OP_DROP OP_6 OP_PICK OP_ROT OP_GREATERTHANOREQUAL OP_VERIFY OP_5 OP_PICK OP_3 OP_ROLL OP_MUL 1027 OP_DIV OP_5 OP_ROLL OP_OVER OP_SUB 76a914 OP_3 OP_ROLL OP_CAT 88ac OP_CAT OP_0 OP_OUTPUTBYTECODE OP_EQUALVERIFY OP_0 OP_OUTPUTVALUE OP_LESSTHANOREQUAL OP_VERIFY 76a914 OP_ROT OP_CAT 88ac OP_CAT OP_1 OP_OUTPUTBYTECODE OP_EQUALVERIFY OP_1 OP_OUTPUTVALUE OP_LESSTHANOREQUAL OP_VERIFY 76a914 OP_3 OP_ROLL OP_CAT 88ac OP_CAT OP_2 OP_OUTPUTBYTECODE OP_EQUALVERIFY OP_2 OP_OUTPUTTOKENCATEGORY OP_INPUTINDEX OP_UTXOTOKENCATEGORY OP_EQUALVERIFY OP_2 OP_OUTPUTTOKENAMOUNT OP_INPUTINDEX OP_UTXOTOKENAMOUNT OP_NUMEQUALVERIFY OP_2 OP_OUTPUTTOKENCOMMITMENT OP_INPUTINDEX OP_UTXOTOKENCOMMITMENT OP_EQUAL OP_NIP OP_NIP OP_ELSE OP_6 OP_ROLL OP_2 OP_NUMEQUALVERIFY OP_6 OP_PICK OP_HASH160 OP_OVER OP_EQUALVERIFY OP_7 OP_ROLL OP_7 OP_ROLL OP_CHECKSIGVERIFY OP_ROT OP_CHECKLOCKTIMEVERIFY OP_DROP OP_INPUTINDEX OP_UTXOVALUE OP_ROT OP_LESSTHAN OP_VERIFY 76a914 OP_SWAP OP_CAT 88ac OP_CAT OP_0 OP_OUTPUTBYTECODE OP_EQUALVERIFY OP_0 OP_OUTPUTTOKENCATEGORY OP_INPUTINDEX OP_UTXOTOKENCATEGORY OP_EQUALVERIFY OP_0 OP_OUTPUTTOKENAMOUNT OP_INPUTINDEX OP_UTXOTOKENAMOUNT OP_NUMEQUALVERIFY OP_0 OP_OUTPUTTOKENCOMMITMENT OP_INPUTINDEX OP_UTXOTOKENCOMMITMENT OP_EQUAL OP_NIP OP_NIP OP_NIP OP_ENDIF OP_ENDIF",
  "source": "// BAZAAR - English Auction Contract\n// BCH Chipnet - CashScript v0.10+\n// NFT auction with automatic bid refunds, timelock, and royalty enforcement\n\npragma cashscript >=0.10.0;\n\ncontract Auction(\n    bytes20 sellerPkh,\n    int minBid,\n    int endTime,\n    bytes20 creatorPkh,\n    int royaltyBasisPoints,\n    int minBidIncrement\n) {\n    // Place a new bid - must be higher than current bid\n    // Refund enforcement handled by AuctionState covenant\n    function bid(\n        int currentBidAmount\n    ) {\n        // Ensure caller provides the correct current bid amount (prevents refund theft)\n        require(currentBidAmount == tx.inputs[this.activeInputIndex].value);\n\n        // Auction must not have ended\n        // require(endTime > tx.locktime); // Disabled due to CashScript limitation with strict inequality\n\n        // New bid must be at least minBidIncrement higher than current\n        int newBidAmount = tx.outputs[0].value;\n        if (currentBidAmount > 0) {\n            require(newBidAmount >= currentBidAmount + minBidIncrement);\n        } else {\n            require(newBidAmount >= minBid);\n        }\n\n        // Output 0: Contract continues with new bid amount (NFT stays in contract)\n        // The contract UTXO is recreated with the new bid\n        require(\n            tx.outputs[0].lockingBytecode\n            == tx.inputs[this.activeInputIndex].lockingBytecode\n        );\n\n        // NFT must stay in the contract\n        require(\n            tx.outputs[0].tokenCategory\n            == tx.inputs[this.activeInputIndex].tokenCategory\n        );\n        require(tx.outputs[0].tokenAmount == tx.inputs[this.activeInputIndex].tokenAmount);\n        require(tx.outputs[0].nftCommitment == tx.inputs[this.activeInputIndex].nftCommitment);\n\n    }\n\n    // Winner claims the NFT after auction ends\n    function claim(\n        int finalBidAmount,\n        bytes20 winnerPkh\n    ) {\n        // Ensure caller provides the correct final bid amount (prevents underpayment)\n        require(finalBidAmount == tx.inputs[this.activeInputIndex].value);\n\n        // Auction must have ended\n        require(tx.time >= endTime);\n\n        // Must have a winning bid\n        require(finalBidAmount >= minBid);\n\n        // Calculate royalty and seller proceeds\n        int royaltyAmount = finalBidAmount * royaltyBasisPoints / 10000;\n        int sellerAmount = finalBidAmount - royaltyAmount;\n\n        // Output 0: Seller receives payment minus royalty\n        bytes25 sellerLockingBytecode = new LockingBytecodeP2PKH(sellerPkh);\n        require(tx.outputs[0].lockingBytecode == sellerLockingBytecode);\n        require(tx.outputs[0].value >= sellerAmount);\n\n        // Output 1: Creator receives royalty\n        bytes25 creatorLockingBytecode = new LockingBytecodeP2PKH(creatorPkh);\n        require(tx.outputs[1].lockingBytecode == creatorLockingBytecode);\n        require(tx.outputs[1].value >= royaltyAmount);\n\n        // Output 2: NFT goes to winner (explicitly enforced)\n        bytes25 winnerLockingBytecode = new LockingBytecodeP2PKH(winnerPkh);\n        require(tx.outputs[2].lockingBytecode == winnerLockingBytecode);\n        require(tx.outputs[2].tokenCategory == tx.inputs[this.activeInputIndex].tokenCategory);\n        require(tx.outputs[2].tokenAmount == tx.inputs[this.activeInputIndex].tokenAmount);\n        require(tx.outputs[2].nftCommitment == tx.inputs[this.activeInputIndex].nftCommitment);\n    }\n\n    // Seller reclaims NFT if no bids were placed after auction ends\n    function reclaim(pubkey pk, sig s) {\n        require(hash160(pk) == sellerPkh);\n        require(checkSig(s, pk));\n        require(tx.time >= endTime);\n        // Only reclaim if no bids were placed (input value still below minBid)\n        require(tx.inputs[this.activeInputIndex].value < minBid);\n        bytes25 sellerLockingBytecode = new LockingBytecodeP2PKH(sellerPkh);\n        require(tx.outputs[0].lockingBytecode == sellerLockingBytecode);\n        require(tx.outputs[0].tokenCategory == tx.inputs[this.activeInputIndex].tokenCategory);\n        require(tx.outputs[0].tokenAmount == tx.inputs[this.activeInputIndex].tokenAmount);\n        require(tx.outputs[0].nftCommitment == tx.inputs[this.activeInputIndex].nftCommitment);\n    }\n}\n",
  "debug": {
    "bytecode": "5679009c635779c0c69d00cc587900a063765979587993a26967765379a2696800cdc0c78800d1c0ce8800d3c0d09d00d2c0cf886d6d6d6d7551675679519c635779c0c69d7bb17556797ba2695579537a9502102796557a78940376a914537a7e0288ac7e00cd8800cca1690376a9147b7e0288ac7e51cd8851cca1690376a914537a7e0288ac7e52cd8852d1c0ce8852d3c0d09d52d2c0cf87777767567a529d5679a97888577a577aad7bb175c0c67b9f690376a9147c7e0288ac7e00cd8800d1c0ce8800d3c0d09d00d2c0cf877777776868",
    "sourceMap": "17:4:49:5;;;;;21:16:21:32;;:46::67;:36::74:1;:8::76;27:38:27:39:0;:27::46:1;28:12:28:28:0;;:31::32;:12:::1;:34:30:9:0;29:20:29:32;:36::52;;:55::70;;:36:::1;:20;:12::72;30:15:32:9:0;31:20:31:32;:36::42;;:20:::1;:12::44;30:15:32:9;37:23:37:24:0;:12::41:1;38:25:38:46:0;:15::63:1;36:8:39:10;43:23:43:24:0;:12::39:1;44:25:44:46:0;:15::61:1;42:8:45:10;46:27:46:28:0;:16::41:1;:55::76:0;:45::89:1;:8::91;47:27:47:28:0;:16::43:1;:57::78:0;:47::93:1;:8::95;17:4:49:5;;;;;;;52::85::0;;;;;57:16:57:30;;:44::65;:34::72:1;:8::74;60:27:60:34:0;:8::36:1;;63:16:63:30:0;;:34::40;:16:::1;:8::42;66:28:66::0;;:45::63;;:28:::1;:66::71:0;:28:::1;67:27:67:41:0;;:44::57;:27:::1;70:40:70:75:0;:65::74;;:40::75:1;;;71:27:71:28:0;:16::45:1;:8::72;72:27:72:28:0;:16::35:1;:::51;:8::53;75:41:75:77:0;:66::76;:41::77:1;;;76:27:76:28:0;:16::45:1;:8::73;77:27:77:28:0;:16::35:1;:::52;:8::54;80:40:80:75:0;:65::74;;:40::75:1;;;81:27:81:28:0;:16::45:1;:8::72;82:27:82:28:0;:16::43:1;:57::78:0;:47::93:1;:8::95;83:27:83:28:0;:16::41:1;:55::76:0;:45::89:1;:8::91;84:27:84:28:0;:16::43:1;:57::78:0;:47::93:1;:8::95;52:4:85:5;;;88::99::0;;;;89:24:89:26;;:16::27:1;:31::40:0;:8::42:1;90:25:90:26:0;;:28::30;;:8::33:1;91:27:91:34:0;:8::36:1;;93:26:93:47:0;:16::54:1;:57::63:0;:16:::1;:8::65;94:40:94:75:0;:65::74;:40::75:1;;;95:27:95:28:0;:16::45:1;:8::72;96:27:96:28:0;:16::43:1;:57::78:0;:47::93:1;:8::95;97:27:97:28:0;:16::41:1;:55::76:0;:45::89:1;:8::91;98:27:98:28:0;:16::43:1;:57::78:0;:47::93:1;:8::95;88:4:99:5;;;7:0:100:1;",
    "logs": [],
    "requires": [
      {
        "ip": 15,
        "line": 21
      },
      {
        "ip": 30,
        "line": 29
      },
      {
        "ip": 36,
        "line": 31
      },
      {
        "ip": 42,
        "line": 36
      },
      {
        "ip": 47,
        "line": 42
      },
      {
        "ip": 52,
        "line": 46
      },
      {
        "ip": 57,
        "line": 47
      },
      {
        "ip": 74,
        "line": 57
      },
      {
        "ip": 76,
        "line": 60
      },
      {
        "ip": 82,
        "line": 63
      },
      {
        "ip": 102,
        "line": 71
      },
      {
        "ip": 106,
        "line": 72
      },
      {
        "ip": 114,
        "line": 76
      },
      {
        "ip": 118,
        "line": 77
      },
      {
        "ip": 127,
        "line": 81
      },
      {
        "ip": 132,
        "line": 82
      },
      {
        "ip": 137,
        "line": 83
      },
      {
        "ip": 143,
        "line": 84
      },
      {
        "ip": 154,
        "line": 89
      },
      {
        "ip": 159,
        "line": 90
      },
      {
        "ip": 161,
        "line": 91
      },
      {
        "ip": 167,
        "line": 93
      },
      {
        "ip": 175,
        "line": 95
      },
      {
        "ip": 180,
        "line": 96
      },
      {
        "ip": 185,
        "line": 97
      },
      {
        "ip": 191,
        "line": 98
      }
    ]
  },
  "compiler": {
    "name": "cashc",
    "version": "0.12.1"
  },
  "updatedAt": "2026-02-25T08:57:50.447Z"
}