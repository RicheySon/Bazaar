{
  "contractName": "FractionalVault",
  "constructorInputs": [
    {
      "name": "sharesCategory",
      "type": "bytes32"
    },
    {
      "name": "totalShares",
      "type": "int"
    },
    {
      "name": "reserveSats",
      "type": "int"
    },
    {
      "name": "claimsScriptHash",
      "type": "bytes32"
    }
  ],
  "abi": [
    {
      "name": "redeemAll",
      "inputs": [
        {
          "name": "pk",
          "type": "pubkey"
        },
        {
          "name": "s",
          "type": "sig"
        }
      ]
    },
    {
      "name": "buyout",
      "inputs": [
        {
          "name": "buyerPkh",
          "type": "bytes20"
        }
      ]
    }
  ],
  "bytecode": "OP_4 OP_PICK OP_0 OP_NUMEQUAL OP_IF OP_6 OP_ROLL OP_6 OP_PICK OP_CHECKSIGVERIFY OP_5 OP_ROLL OP_HASH160 OP_1 OP_UTXOTOKENCATEGORY 20 OP_SPLIT OP_DROP OP_ROT OP_EQUALVERIFY OP_1 OP_UTXOTOKENAMOUNT OP_ROT OP_NUMEQUALVERIFY OP_INPUTINDEX OP_UTXOTOKENCATEGORY OP_0 OP_OUTPUTTOKENCATEGORY OP_EQUALVERIFY OP_0 OP_OUTPUTTOKENAMOUNT OP_INPUTINDEX OP_UTXOTOKENAMOUNT OP_NUMEQUALVERIFY OP_0 OP_OUTPUTTOKENCOMMITMENT OP_INPUTINDEX OP_UTXOTOKENCOMMITMENT OP_EQUALVERIFY OP_0 OP_OUTPUTBYTECODE 76a914 OP_ROT OP_CAT 88ac OP_CAT OP_EQUAL OP_NIP OP_NIP OP_NIP OP_ELSE OP_4 OP_ROLL OP_1 OP_NUMEQUALVERIFY aa20 OP_4 OP_ROLL OP_CAT 87 OP_CAT OP_0 OP_OUTPUTBYTECODE OP_EQUALVERIFY OP_0 OP_OUTPUTVALUE OP_3 OP_ROLL OP_GREATERTHANOREQUAL OP_VERIFY OP_1 OP_UTXOTOKENCATEGORY 20 OP_SPLIT OP_DROP OP_EQUALVERIFY OP_0 OP_OUTPUTTOKENCATEGORY OP_1 OP_UTXOTOKENCATEGORY OP_EQUALVERIFY OP_0 OP_OUTPUTTOKENAMOUNT OP_1 OP_UTXOTOKENAMOUNT OP_NUMEQUALVERIFY OP_0 OP_OUTPUTTOKENCOMMITMENT OP_1 OP_UTXOTOKENCOMMITMENT OP_EQUALVERIFY OP_INPUTINDEX OP_UTXOTOKENCATEGORY OP_1 OP_OUTPUTTOKENCATEGORY OP_EQUALVERIFY OP_1 OP_OUTPUTTOKENAMOUNT OP_INPUTINDEX OP_UTXOTOKENAMOUNT OP_NUMEQUALVERIFY OP_1 OP_OUTPUTTOKENCOMMITMENT OP_INPUTINDEX OP_UTXOTOKENCOMMITMENT OP_EQUALVERIFY OP_1 OP_OUTPUTBYTECODE 76a914 OP_3 OP_ROLL OP_CAT 88ac OP_CAT OP_EQUAL OP_NIP OP_ENDIF",
  "source": "// BAZAAR - Fractionalized NFT Vault Contract\r\n// BCH Chipnet - CashScript v0.10+\r\n// Holds an original NFT escrowed for fractional ownership.\r\n// Shares are FTs of sharesCategory; a mutable tracking NFT (same category)\r\n// is held by the companion FractionalClaims covenant.\r\n//\r\n// Two exit paths:\r\n//   redeemAll — burn the full 1,000,000 FT supply → receive original NFT\r\n//   buyout    — pay ≥ reserveSats → claims covenant receives BCH, buyer receives NFT\r\n\r\npragma cashscript >=0.10.0;\r\n\r\ncontract FractionalVault(\r\n    bytes32 sharesCategory,   // token category of the share FTs + tracking NFT\r\n    int totalShares,          // 1000000\r\n    int reserveSats,          // fixed buyout price in satoshis\r\n    bytes32 claimsScriptHash  // sha256d of FractionalClaims redeem script (for P2SH32)\r\n) {\r\n    // Burn 100% of shares → receive the original NFT back\r\n    // Input[0]: this vault UTXO (holds original NFT)\r\n    // Input[1]: FT UTXO carrying all totalShares of sharesCategory\r\n    // Output[0]: original NFT to redeemer P2PKH\r\n    function redeemAll(pubkey pk, sig s) {\n        require(checkSig(s, pk));\n        bytes20 pkh = hash160(pk);\n\r\n        // Input[1] must carry the full share supply of sharesCategory\r\n        require(tx.inputs[1].tokenCategory.split(32)[0] == sharesCategory);\r\n        require(tx.inputs[1].tokenAmount == totalShares);\r\n\r\n        // Output[0] must carry the original NFT to the redeemer\n        bytes vaultNftCat = tx.inputs[this.activeInputIndex].tokenCategory;\n        require(tx.outputs[0].tokenCategory == vaultNftCat);\n        require(tx.outputs[0].tokenAmount == tx.inputs[this.activeInputIndex].tokenAmount);\n        require(tx.outputs[0].nftCommitment == tx.inputs[this.activeInputIndex].nftCommitment);\n        require(tx.outputs[0].lockingBytecode == new LockingBytecodeP2PKH(pkh));\n    }\n\r\n    // Pay ≥ reserve → get original NFT; proceeds locked into FractionalClaims\r\n    // Input[0]: this vault UTXO\r\n    // Input[1]: claims covenant UTXO (carries mutable tracking NFT)\r\n    // Input[2+]: buyer BCH UTXOs\r\n    // Output[0]: new claims UTXO (P2SH32, ≥ reserveSats, mutable NFT preserved)\r\n    // Output[1]: original NFT to buyer P2PKH\r\n    function buyout(bytes20 buyerPkh) {\n        // Output[0]: claims contract must receive at least the full reserve\n        bytes35 claimsLocking = new LockingBytecodeP2SH32(claimsScriptHash);\n        require(tx.outputs[0].lockingBytecode == claimsLocking);\n        require(tx.outputs[0].value >= reserveSats);\n        // Ensure the claims UTXO (input[1]) is preserved with its tracking NFT\n        require(tx.inputs[1].tokenCategory.split(32)[0] == sharesCategory);\n        require(tx.outputs[0].tokenCategory == tx.inputs[1].tokenCategory);\n        require(tx.outputs[0].tokenAmount == tx.inputs[1].tokenAmount);\n        require(tx.outputs[0].nftCommitment == tx.inputs[1].nftCommitment);\n\r\n        // Output[1]: original NFT delivered to buyer\n        bytes vaultNftCat = tx.inputs[this.activeInputIndex].tokenCategory;\n        require(tx.outputs[1].tokenCategory == vaultNftCat);\n        require(tx.outputs[1].tokenAmount == tx.inputs[this.activeInputIndex].tokenAmount);\n        require(tx.outputs[1].nftCommitment == tx.inputs[this.activeInputIndex].nftCommitment);\n        require(tx.outputs[1].lockingBytecode == new LockingBytecodeP2PKH(buyerPkh));\n    }\n}\n",
  "debug": {
    "bytecode": "5479009c63567a5679ad557aa951ce01207f757b8851d07b9dc0ce00d18800d3c0d09d00d2c0cf8800cd0376a9147b7e0288ac7e8777777767547a519d02aa20547a7e01877e00cd8800cc537aa26951ce01207f758800d151ce8800d351d09d00d251cf88c0ce51d18851d3c0d09d51d2c0cf8851cd0376a914537a7e0288ac7e877768",
    "sourceMap": "23:4:37:5;;;;;24:25:24:26;;:28::30;;:8::33:1;25:30:25:32:0;;:22::33:1;28:26:28:27:0;:16::42:1;:49::51:0;:16::52:1;:::55;:59::73:0;:8::75:1;29:26:29:27:0;:16::40:1;:44::55:0;:8::57:1;32:38:32:59:0;:28::74:1;33:27:33:28:0;:16::43:1;:8::60;34:27:34:28:0;:16::41:1;:55::76:0;:45::89:1;:8::91;35:27:35:28:0;:16::43:1;:57::78:0;:47::93:1;:8::95;36:27:36:28:0;:16::45:1;:49::78:0;:74::77;:49::78:1;;;:8::80;23:4:37:5;;;;45::62::0;;;;47:32:47:75;:58::74;;:32::75:1;;;48:27:48:28:0;:16::45:1;:8::64;49:27:49:28:0;:16::35:1;:39::50:0;;:16:::1;:8::52;51:26:51:27:0;:16::42:1;:49::51:0;:16::52:1;:::55;:8::75;52:27:52:28:0;:16::43:1;:57::58:0;:47::73:1;:8::75;53:27:53:28:0;:16::41:1;:55::56:0;:45::69:1;:8::71;54:27:54:28:0;:16::43:1;:57::58:0;:47::73:1;:8::75;57:38:57:59:0;:28::74:1;58:27:58:28:0;:16::43:1;:8::60;59:27:59:28:0;:16::41:1;:55::76:0;:45::89:1;:8::91;60:27:60:28:0;:16::43:1;:57::78:0;:47::93:1;:8::95;61:27:61:28:0;:16::45:1;:49::83:0;:74::82;;:49::83:1;;;:8::85;45:4:62:5;13:0:63:1",
    "logs": [],
    "requires": [
      {
        "ip": 13,
        "line": 24
      },
      {
        "ip": 23,
        "line": 28
      },
      {
        "ip": 27,
        "line": 29
      },
      {
        "ip": 32,
        "line": 33
      },
      {
        "ip": 37,
        "line": 34
      },
      {
        "ip": 42,
        "line": 35
      },
      {
        "ip": 51,
        "line": 36
      },
      {
        "ip": 67,
        "line": 48
      },
      {
        "ip": 73,
        "line": 49
      },
      {
        "ip": 79,
        "line": 51
      },
      {
        "ip": 84,
        "line": 52
      },
      {
        "ip": 89,
        "line": 53
      },
      {
        "ip": 94,
        "line": 54
      },
      {
        "ip": 99,
        "line": 58
      },
      {
        "ip": 104,
        "line": 59
      },
      {
        "ip": 109,
        "line": 60
      },
      {
        "ip": 119,
        "line": 61
      }
    ]
  },
  "compiler": {
    "name": "cashc",
    "version": "0.12.1"
  },
  "updatedAt": "2026-02-25T07:05:40.107Z"
}